"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const h=require("react"),t=require("react/jsx-runtime");function _(e={}){const{onDrop:s,accept:o,disabled:n=!1,noClick:u=!1}=e,[d,p]=h.useState(!1),i=h.useRef(null),r=h.useRef(0),a=h.useCallback(x=>{var v,P;x.preventDefault(),x.stopPropagation(),!n&&(r.current++,(P=(v=x.dataTransfer)==null?void 0:v.items)!=null&&P.length&&p(!0))},[n]),c=h.useCallback(x=>{x.preventDefault(),x.stopPropagation(),!n&&(r.current--,r.current===0&&p(!1))},[n]),l=h.useCallback(x=>{x.preventDefault(),x.stopPropagation(),!n&&(x.dataTransfer.dropEffect="copy")},[n]),g=h.useCallback(x=>{var P;if(x.preventDefault(),x.stopPropagation(),n)return;r.current=0,p(!1);const v=(P=x.dataTransfer)==null?void 0:P.files;console.log("[useDropzone] Files dropped:",v==null?void 0:v.length,v),v!=null&&v.length&&s&&s(v)},[n,s]),k=h.useCallback(()=>{var x;n||u||(x=i.current)==null||x.click()},[n,u]),U=h.useCallback(x=>{const v=x.target.files;console.log("[useDropzone] Files selected via input:",v==null?void 0:v.length,v),v!=null&&v.length&&s&&s(v),x.target.value=""},[s]),F=h.useCallback(()=>{var x;(x=i.current)==null||x.click()},[]),f=h.useCallback(()=>({onDragEnter:a,onDragLeave:c,onDragOver:l,onDrop:g,onClick:k,role:"button",tabIndex:n?-1:0,"aria-disabled":n}),[a,c,l,g,k,n]),b=h.useCallback(()=>({type:"file",multiple:!0,accept:o==null?void 0:o.join(","),onChange:U,style:{display:"none"},tabIndex:-1}),[o,U]),C=h.useCallback(()=>i,[]);return h.useEffect(()=>()=>{r.current=0},[]),{getRootProps:f,getInputProps:b,getInputRef:C,isDragging:d,open:F}}function Q(e,s){var p;if(!s||s.length===0)return null;const o=e.type,u=(p=e.name.split(".").pop())==null?void 0:p.toLowerCase();return s.some(i=>{if(i.endsWith("/*")){const r=i.replace("/*","");return o.startsWith(r)}return i.includes("/")?o===i:i.startsWith(".")?`.${u}`===i.toLowerCase():!1})?null:{file:e,type:"type",message:`File type "${o||u}" is not allowed. Accepted: ${s.join(", ")}`}}function Y(e,s){if(!s)return null;if(e.size>s){const o=(s/1048576).toFixed(1),n=(e.size/(1024*1024)).toFixed(1);return{file:e,type:"size",message:`File "${e.name}" (${n}MB) exceeds maximum size of ${o}MB`}}return null}function ee(e,s,o){return o&&e+s>o?{file:new File([],""),type:"count",message:`Cannot add ${s} files. Maximum allowed: ${o}, current: ${e}`}:null}function E(e,s){const o=Q(e,s.accept);if(o)return o;const n=Y(e,s.maxSize);return n||null}function M(e,s,o){const n=[],u=[],d=ee(s,e.length,o.maxFiles);d&&u.push(d);const p=o.maxFiles?Math.min(e.length,o.maxFiles-s):e.length;for(let i=0;i<e.length;i++){const r=e[i];if(i<p){const a=E(r,o);a?u.push(a):n.push(r)}}return{valid:n,errors:u}}function se(){return`file_${Date.now()}_${Math.random().toString(36).slice(2,11)}`}function S(e){if(e===0)return"0 B";const s=["B","KB","MB","GB"],o=1024,n=Math.floor(Math.log(e)/Math.log(o));return`${parseFloat((e/Math.pow(o,n)).toFixed(1))} ${s[n]}`}function I(e){var s;return((s=e.split(".").pop())==null?void 0:s.toLowerCase())||""}function q(e){return e.type.startsWith("image/")}function z(e){return e.type.startsWith("video/")}function te(){const[e,s]=h.useState({}),o=h.useCallback((i,r)=>new Promise(a=>{if(!q(r)&&!z(r)){a(null);return}const c=URL.createObjectURL(r);s(l=>({...l,[i]:c})),a(c)}),[]),n=h.useCallback(async i=>{const r={};for(const{id:a,file:c}of i)q(c)||z(c)?r[a]=URL.createObjectURL(c):r[a]=null;s(a=>({...a,...r}))},[]),u=h.useCallback(i=>{s(r=>{const a=r[i];a&&URL.revokeObjectURL(a);const{[i]:c,...l}=r;return l})},[]),d=h.useCallback(()=>{s(i=>(Object.values(i).forEach(r=>{r&&URL.revokeObjectURL(r)}),{}))},[]),p=h.useCallback(i=>e[i]??null,[e]);return h.useEffect(()=>()=>{Object.values(e).forEach(i=>{i&&URL.revokeObjectURL(i)})},[]),{previews:e,generatePreview:o,generatePreviews:n,removePreview:u,clearPreviews:d,getPreview:p}}function L(e){const{url:s,file:o,fieldName:n="file",headers:u={},onProgress:d,signal:p}=e;return new Promise(i=>{const r=new XMLHttpRequest,a=new FormData;a.append(n,o),r.upload.addEventListener("progress",c=>{if(c.lengthComputable&&d){const l=Math.round(c.loaded/c.total*100);console.log("[uploader] XHR progress:",l,"%"),d(l)}}),r.addEventListener("load",()=>{if(r.status>=200&&r.status<300){let c;try{c=JSON.parse(r.responseText)}catch{c=r.responseText}i({id:"",success:!0,response:c})}else i({id:"",success:!1,error:`Upload failed with status ${r.status}: ${r.statusText}`})}),r.addEventListener("error",()=>{i({id:"",success:!1,error:"Network error occurred during upload"})}),r.addEventListener("abort",()=>{i({id:"",success:!1,error:"Upload was cancelled"})}),p&&p.addEventListener("abort",()=>{r.abort()}),r.open("POST",s,!0),Object.entries(u).forEach(([c,l])=>{r.setRequestHeader(c,l)}),r.send(a)})}async function B(e,s){const{concurrent:o=3,onFileProgress:n,...u}=s,d=[],p=[...e];async function i(){const a=p.shift();if(!a)return;console.log("[uploader] Starting upload for:",a.file.name);const c=await L({...u,file:a.file,onProgress:l=>{console.log("[uploader] Progress for",a.id,":",l,"%"),n==null||n(a.id,l)}});d.push({...c,id:a.id}),await i()}const r=Array(Math.min(o,e.length)).fill(null).map(()=>i());return await Promise.all(r),d}async function re(e,s=3,o=1e3){let n;for(let u=0;u<=s;u++){const d=await L(e);if(d.success||(n=d.error,d.error==="Upload was cancelled"))return d;if(u<s){const p=o*Math.pow(2,u);await new Promise(i=>setTimeout(i,p))}}return{id:"",success:!1,error:`Upload failed after ${s+1} attempts: ${n}`}}function O(e={}){const{accept:s,maxFiles:o,maxSize:n,uploadUrl:u="/api/upload",headers:d,fieldName:p="file",onUploadComplete:i,onProgress:r,onError:a}=e,[c,l]=h.useState([]),[g,k]=h.useState({}),[U,F]=h.useState(!1),[f,b]=h.useState([]),C=h.useRef(null),x=h.useCallback(y=>q(y)||z(y)?URL.createObjectURL(y):null,[]),v=h.useCallback(y=>{console.log("[useFileUploader] addFiles called with:",y);const w=Array.from(y);console.log("[useFileUploader] fileArray:",w);const{valid:m,errors:j}=M(w,c.length,{accept:s,maxSize:n,maxFiles:o});if(console.log("[useFileUploader] Validation result - valid:",m.length,"errors:",j.length),j.length>0&&(b($=>[...$,...j]),j.forEach($=>a==null?void 0:a($))),m.length>0){const $=m.map(R=>({id:se(),file:R,preview:x(R),progress:0,status:"pending"}));console.log("[useFileUploader] Adding new file entries:",$),l(R=>[...R,...$])}},[c.length,s,n,o,a,x]),P=h.useCallback(y=>{l(w=>{const m=w.find(j=>j.id===y);return m!=null&&m.preview&&URL.revokeObjectURL(m.preview),w.filter(j=>j.id!==y)}),k(w=>{const{[y]:m,...j}=w;return j})},[]),D=h.useCallback((y,w)=>{k(m=>({...m,[y]:w})),l(m=>m.map(j=>j.id===y?{...j,progress:w}:j)),r==null||r(y,w)},[r]),K=h.useCallback(async()=>{const y=c.filter(w=>w.status==="pending");if(y.length===0)return[];console.log("[useFileUploader] Starting upload for",y.length,"files"),F(!0),C.current=new AbortController,l(w=>w.map(m=>m.status==="pending"?{...m,status:"uploading",progress:0}:m));try{const w=await B(y.map(m=>({id:m.id,file:m.file})),{url:u,headers:d,fieldName:p,signal:C.current.signal,onFileProgress:(m,j)=>{console.log("[useFileUploader] Progress update:",m,j),D(m,j)}});return console.log("[useFileUploader] Upload results:",w),l(m=>m.map(j=>{const $=w.find(R=>R.id===j.id);return $?{...j,status:$.success?"success":"error",error:$.error,progress:$.success?100:j.progress}:j})),w.forEach(m=>{m.success?i==null||i(m):a==null||a(m)}),w}finally{F(!1),C.current=null}},[c,u,d,p,D,i,a]),X=h.useCallback(()=>{b([])},[]),J=h.useCallback(()=>{var y;(y=C.current)==null||y.abort(),c.forEach(w=>{w.preview&&URL.revokeObjectURL(w.preview)}),l([]),k({}),F(!1),b([])},[c]);return{files:c,addFiles:v,removeFile:P,upload:K,uploadProgress:g,isUploading:U,errors:f,clearErrors:X,reset:J}}const ne=()=>t.jsxs("svg",{className:"mq-dropzone__icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),t.jsx("polyline",{points:"17 8 12 3 7 8"}),t.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]});function W({onFiles:e,accept:s,disabled:o=!1,className:n="",children:u,isDragging:d}){const p=_({onDrop:l=>{console.log("[DropZone] onDrop called with files:",l),e==null||e(l)},accept:s,disabled:o}),r=["mq-dropzone",(d??p.isDragging)&&"mq-dropzone--dragging",o&&"mq-dropzone--disabled",n].filter(Boolean).join(" "),a=p.getInputProps(),c=p.getInputRef();return t.jsxs("div",{className:r,...p.getRootProps(),children:[t.jsx("input",{type:a.type,multiple:a.multiple,accept:a.accept,onChange:a.onChange,ref:c,style:a.style,tabIndex:a.tabIndex}),u||t.jsxs(t.Fragment,{children:[t.jsx(ne,{}),t.jsxs("div",{className:"mq-dropzone__text",children:[t.jsxs("p",{className:"mq-dropzone__title",children:["Drag & drop files here, or"," ",t.jsx("span",{className:"mq-dropzone__browse",children:"browse"})]}),t.jsx("p",{className:"mq-dropzone__subtitle",children:s!=null&&s.length?`Supports: ${s.join(", ")}`:"All file types supported"})]})]})]})}function A({value:e,className:s="",showText:o=!1,status:n="uploading"}){const u=Math.min(100,Math.max(0,e)),d=n!=="uploading"&&n!=="pending"?`mq-progress--${n}`:"";return t.jsxs("div",{className:`mq-progress-wrapper ${s}`,children:[t.jsx("div",{className:`mq-progress ${d}`,children:t.jsx("div",{className:"mq-progress__bar",style:{width:`${u}%`},role:"progressbar","aria-valuenow":u,"aria-valuemin":0,"aria-valuemax":100})}),o&&t.jsxs("span",{className:"mq-progress__text",children:[u,"%"]})]})}const oe=()=>t.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),t.jsx("polyline",{points:"14 2 14 8 20 8"})]}),ae=()=>t.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"16",height:"16",children:[t.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),ie=()=>t.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"16",height:"16",children:t.jsx("polyline",{points:"20 6 9 17 4 12"})}),le=()=>t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",style:{animation:"spin 1s linear infinite"},children:[t.jsx("circle",{cx:"12",cy:"12",r:"10",opacity:"0.25"}),t.jsx("path",{d:"M12 2a10 10 0 0 1 10 10"}),t.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"})]});function T({file:e,onRemove:s,className:o="",showRemove:n=!0}){const u=I(e.file.name).toUpperCase(),d=e.status==="success"||e.status==="error"?`mq-file-preview--${e.status}`:"",p=e.status==="uploading";return t.jsxs("div",{className:`mq-file-preview ${d} ${o}`,children:[t.jsx("div",{className:"mq-file-preview__thumbnail",children:e.preview?t.jsx("img",{src:e.preview,alt:e.file.name}):t.jsx("div",{className:"mq-file-preview__icon",children:t.jsx(oe,{})})}),t.jsxs("div",{className:"mq-file-preview__info",children:[t.jsx("p",{className:"mq-file-preview__name",title:e.file.name,children:e.file.name}),t.jsxs("div",{className:"mq-file-preview__meta",children:[t.jsx("span",{children:S(e.file.size)}),u&&t.jsx("span",{children:"•"}),u&&t.jsx("span",{children:u}),e.status==="pending"&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"•"}),t.jsx("span",{style:{color:"var(--mq-gray-400)"},children:"Ready"})]}),e.status==="uploading"&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"•"}),t.jsxs("span",{style:{color:"var(--mq-primary)",display:"flex",alignItems:"center",gap:"4px"},children:[t.jsx(le,{})," Uploading ",e.progress,"%"]})]}),e.status==="success"&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"•"}),t.jsxs("span",{style:{color:"var(--mq-success)",display:"flex",alignItems:"center",gap:"2px"},children:[t.jsx(ie,{})," Uploaded"]})]}),e.status==="error"&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"•"}),t.jsx("span",{style:{color:"var(--mq-error)"},children:"Failed"})]})]}),p&&t.jsx("div",{style:{marginTop:"0.5rem"},children:t.jsx(A,{value:e.progress,status:"uploading",showText:!0})}),e.error&&t.jsx("p",{className:"mq-file-preview__error",children:e.error})]}),n&&s&&t.jsx("button",{type:"button",className:"mq-file-preview__remove",onClick:()=>s(e.id),"aria-label":`Remove ${e.file.name}`,children:t.jsx(ae,{})})]})}function H({files:e,onRemove:s,showPreview:o=!0,showProgress:n=!0,className:u=""}){return e.length===0?null:t.jsx("div",{className:`mq-file-list ${u}`,children:e.map(d=>t.jsx(T,{file:{...d,progress:n?d.progress:0},onRemove:s,showRemove:!0},d.id))})}const ce=()=>t.jsxs("svg",{className:"mq-error-item__icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("circle",{cx:"12",cy:"12",r:"10"}),t.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),t.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]});function ue({uploadUrl:e="/api/upload",accept:s,maxFiles:o,maxSize:n,showPreview:u=!0,showProgress:d=!0,autoUpload:p=!1,className:i="",onComplete:r,onError:a,children:c,disabled:l=!1}){const g=O({accept:s,maxFiles:o,maxSize:n,uploadUrl:e,onError:f=>{a==null||a(f)}});h.useEffect(()=>{p&&g.files.some(f=>f.status==="pending")&&g.upload().then(f=>{r==null||r(f)})},[p,g.files]);const k=async()=>{const f=await g.upload();r==null||r(f)},U=g.files.some(f=>f.status==="pending"),F=g.errors.length>0;return t.jsxs("div",{className:`mq-uploader ${i}`,children:[t.jsx(W,{onFiles:g.addFiles,accept:s,disabled:l||g.isUploading,children:c}),F&&t.jsx("div",{className:"mq-error-list",children:g.errors.map((f,b)=>t.jsxs("div",{className:"mq-error-item",children:[t.jsx(ce,{}),t.jsx("span",{children:f.message})]},b))}),t.jsx(H,{files:g.files,onRemove:g.removeFile,showPreview:u,showProgress:d}),U&&!p&&t.jsx("button",{type:"button",className:`mq-upload-btn ${g.isUploading?"mq-upload-btn--loading":""}`,onClick:k,disabled:g.isUploading||l,children:g.isUploading?"Uploading...":`Upload ${g.files.filter(f=>f.status==="pending").length} file(s)`})]})}async function V(e,s){const{url:o,file:n,fieldName:u="file",headers:d={},onProgress:p,signal:i,additionalData:r={}}=s,a=new FormData;a.append(u,n),Object.entries(r).forEach(([c,l])=>{a.append(c,l)});try{return{id:"",success:!0,response:(await e.post(o,a,{headers:{"Content-Type":"multipart/form-data",...d},signal:i,onUploadProgress:l=>{if(l.total){const g=Math.round(l.loaded/l.total*100);console.log("[axios-uploader] Progress:",g,"%"),p==null||p(g)}}})).data}}catch(c){const l=c;return l.code==="ERR_CANCELED"||l.name==="CanceledError"?{id:"",success:!1,error:"Upload was cancelled"}:{id:"",success:!1,error:l.response?`Upload failed with status ${l.response.status}: ${l.response.statusText}`:`Upload failed: ${l.message}`}}}async function de(e,s,o){const{concurrent:n=3,onFileProgress:u,...d}=o,p=[],i=[...s];async function r(){const c=i.shift();if(!c)return;const l=await V(e,{...d,file:c.file,onProgress:g=>{u==null||u(c.id,g)}});p.push({...l,id:c.id}),await r()}const a=Array(Math.min(n,s.length)).fill(null).map(()=>r());return await Promise.all(a),p}function Z(e,s=1024*1024){const o=[];let n=0;for(;n<e.size;){const u=e.slice(n,n+s);o.push(u),n+=s}return o}async function pe(e){const{url:s,file:o,chunkSize:n=1024*1024,fieldName:u="file",headers:d={},onProgress:p,onChunkComplete:i,signal:r}=e,a=Z(o,n),c=a.length,l=[];let g=0;console.log(`[Chunker] Starting chunked upload: ${o.name}, ${c} chunks`);for(let k=0;k<a.length;k++){if(r!=null&&r.aborted)return{success:!1,responses:l,error:"Upload was cancelled"};const U=a[k],F=new FormData;F.append(u,U,o.name),F.append("chunkIndex",String(k)),F.append("totalChunks",String(c)),F.append("fileName",o.name),F.append("fileSize",String(o.size));try{const f=await fetch(s,{method:"POST",headers:d,body:F,signal:r});if(!f.ok)return{success:!1,responses:l,error:`Chunk ${k+1}/${c} failed: ${f.statusText}`};const b=await f.json().catch(()=>({}));l.push(b),g+=U.size;const C=Math.round(g/o.size*100);p==null||p(C),i==null||i(k,c),console.log(`[Chunker] Chunk ${k+1}/${c} uploaded (${C}%)`)}catch(f){return f.name==="AbortError"?{success:!1,responses:l,error:"Upload was cancelled"}:{success:!1,responses:l,error:`Chunk ${k+1}/${c} failed: ${f.message}`}}}return{success:!0,responses:l}}function ge(e,s=5*1024*1024){return e.size>s}async function G(e,s={}){const{maxWidth:o=1920,maxHeight:n=1080,quality:u=.8,format:d="image/jpeg"}=s;return e.type.startsWith("image/")?new Promise((p,i)=>{const r=new Image,a=document.createElement("canvas"),c=a.getContext("2d");if(!c){i(new Error("Failed to get canvas context"));return}r.onload=()=>{let{width:l,height:g}=r;l>o&&(g=g*o/l,l=o),g>n&&(l=l*n/g,g=n),a.width=l,a.height=g,c.drawImage(r,0,0,l,g),a.toBlob(k=>{if(!k){i(new Error("Failed to compress image"));return}const U=d.split("/")[1],F=e.name.replace(/\.[^/.]+$/,`.${U}`),f=new File([k],F,{type:d}),b=e.size,C=f.size;console.log(`[Compression] ${e.name}: ${N(b)} → ${N(C)} (${Math.round((1-C/b)*100)}% reduction)`),p({file:f,originalSize:b,compressedSize:C,compressionRatio:C/b})},d,u),URL.revokeObjectURL(r.src)},r.onerror=()=>{URL.revokeObjectURL(r.src),i(new Error("Failed to load image for compression"))},r.src=URL.createObjectURL(e)}):{file:e,originalSize:e.size,compressedSize:e.size,compressionRatio:1}}async function he(e,s={}){return await Promise.all(e.map(n=>G(n,s)))}function N(e){if(e===0)return"0 B";const s=["B","KB","MB","GB"],o=1024,n=Math.floor(Math.log(e)/Math.log(o));return`${parseFloat((e/Math.pow(o,n)).toFixed(1))} ${s[n]}`}function me(e,s=500*1024){return e.type.startsWith("image/")&&e.size>s}function fe(e){return e.size>5*1024*1024?{maxWidth:1920,maxHeight:1080,quality:.7,format:"image/jpeg"}:e.size>1*1024*1024?{maxWidth:2560,maxHeight:1440,quality:.8,format:"image/jpeg"}:{maxWidth:3840,maxHeight:2160,quality:.9,format:"image/webp"}}exports.DropZone=W;exports.FileList=H;exports.FilePreview=T;exports.FileUploader=ue;exports.ProgressBar=A;exports.compressImage=G;exports.compressImages=he;exports.formatFileSize=S;exports.getFileExtension=I;exports.getOptimalCompressionOptions=fe;exports.isImageFile=q;exports.isVideoFile=z;exports.shouldCompress=me;exports.shouldUseChunkedUpload=ge;exports.splitFileIntoChunks=Z;exports.uploadFile=L;exports.uploadFileChunked=pe;exports.uploadFiles=B;exports.uploadFilesWithAxios=de;exports.uploadWithAxios=V;exports.uploadWithRetry=re;exports.useDropzone=_;exports.useFilePreview=te;exports.useFileUploader=O;exports.validateFile=E;exports.validateFiles=M;
